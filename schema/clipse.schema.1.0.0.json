{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.com/schemas/cli-objects-actions.schema.json",
  "title": "CLI Objects/Actions Specification",
  "type": "object",
  "required": [
    "global",
    "behavior",
    "objects",
    "actions"
  ],
  "additionalProperties": false,
  "properties": {
    "title": {
      "type": "string"
    },
    "description": {
      "type": "string"
    },
    "version": {
      "type": "string"
    },
    "clipse_version": {
      "type": "string"
    },
    "shared_defs": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "vars": {
          "type": "object",
          "additionalProperties": {
            "type": [
              "string",
              "number",
              "boolean"
            ]
          }
        },
        "options": {
          "type": "object",
          "description": "Reusable option blueprints (NO id required here).",
          "additionalProperties": {
            "$ref": "#/$defs/optionDefNoId"
          }
        },
        "actions": {
          "type": "object",
          "description": "Reusable action blueprints (NO id required here).",
          "additionalProperties": {
            "$ref": "#/$defs/actionDefNoId"
          }
        },
        "objects": {
          "type": "object",
          "description": "Reusable object blueprints (NO id required here).",
          "additionalProperties": {
            "$ref": "#/$defs/objectDefNoId"
          }
        }
      },
      "default": {}
    },
    "global": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "options": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/optionUse"
          },
          "default": []
        }
      }
    },
    "behavior": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "allow_abbrev": {
          "type": "boolean",
          "default": false
        },
        "stop_at_positional": {
          "type": "boolean",
          "default": true
        },
        "env_prefix": {
          "type": "string",
          "default": ""
        },
        "completion": {
          "type": "array",
          "items": {
            "enum": [
              "bash",
              "zsh",
              "fish",
              "powershell"
            ]
          },
          "uniqueItems": true,
          "default": []
        },
        "color": {
          "enum": [
            "auto",
            "always",
            "never"
          ],
          "default": "auto"
        },
        "pager": {
          "type": "boolean",
          "default": false
        },
        "telemetry": {
          "type": "boolean",
          "default": false
        },
        "exit_codes": {
          "type": "object",
          "additionalProperties": {
            "type": "integer"
          },
          "default": {
            "ok": 0,
            "usage": 2,
            "runtime_error": 1
          }
        },
        "io": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "stdin": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "accepts": {
                  "type": "boolean",
                  "default": false
                },
                "when": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  },
                  "default": []
                }
              }
            },
            "stdout": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "default": {
                  "enum": [
                    "text",
                    "table",
                    "json",
                    "yaml",
                    "ndjson",
                    "binary"
                  ],
                  "default": "text"
                }
              }
            },
            "stderr": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "diagnostics": {
                  "type": "boolean",
                  "default": true
                }
              }
            },
            "pipes_and_redirection": {
              "type": "boolean",
              "default": true
            }
          },
          "default": {
            "pipes_and_redirection": true
          }
        }
      }
    },
    "rendering": {
      "type": "object",
      "additionalProperties": true
    },
    "objects": {
      "type": "array",
      "minItems": 0,
      "items": {
        "$ref": "#/$defs/objectUse"
      },
      "default": []
    },
    "actions": {
      "type": "array",
      "minItems": 0,
      "items": {
        "$ref": "#/$defs/actionUse"
      },
      "default": []
    }
  },
  "$defs": {
    "envDef": {
      "oneOf": [
        {
          "type": "string"
        },
        {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "var"
          ],
          "properties": {
            "var": {
              "type": "string"
            },
            "override_cli": {
              "type": "boolean",
              "default": false
            },
            "update": {
              "type": "boolean",
              "default": false
            }
          }
        }
      ]
    },
    "typeInline": {
      "type": "object",
      "additionalProperties": true,
      "required": [
        "kind"
      ],
      "properties": {
        "kind": {
          "enum": [
            "any",
            "boolean",
            "string",
            "integer",
            "number",
            "decimal",
            "enum",
            "list",
            "object",
            "date",
            "datetime",
            "url",
            "json",
            "path",
            "file",
            "dir"
          ]
        },
        "values": {
          "type": "array",
          "items": {
            "type": [
              "string",
              "number",
              "integer",
              "boolean"
            ]
          }
        },
        "of": {
          "oneOf": [
            {
              "type": "string"
            },
            {
              "$ref": "#/$defs/typeInline"
            }
          ]
        },
        "format": {
          "type": "string"
        },
        "constraints": {
          "type": "object",
          "additionalProperties": true
        }
      }
    },
    "exampleScenario": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "description": {
          "type": "string"
        },
        "object": {
          "type": "string"
        },
        "action": {
          "type": "string"
        },
        "globals": {
          "type": "object",
          "additionalProperties": true
        },
        "options": {
          "type": "object",
          "additionalProperties": true
        },
        "positionals": {
          "type": "object",
          "additionalProperties": true
        },
        "stdin": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "use": {
              "type": "boolean",
              "default": false
            },
            "content_type": {
              "type": "string"
            },
            "payload": {
              "type": "string"
            }
          }
        },
        "env": {
          "type": "array",
          "items": {
            "type": "object",
            "required": [
              "var",
              "value"
            ],
            "properties": {
              "var": {
                "type": "string"
              },
              "value": {
                "type": "string"
              }
            }
          }
        }
      },
      "required": [
        "object",
        "action"
      ]
    },
    "constraints": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "requires": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "default": []
        },
        "conflicts": {
          "type": "array",
          "items": {
            "type": "array",
            "minItems": 2,
            "items": {
              "type": "string"
            }
          },
          "default": []
        },
        "exactly_one_of": {
          "type": "array",
          "items": {
            "type": "array",
            "minItems": 2,
            "items": {
              "type": "string"
            }
          },
          "default": []
        },
        "at_least_one_of": {
          "type": "array",
          "items": {
            "type": "array",
            "minItems": 2,
            "items": {
              "type": "string"
            }
          },
          "default": []
        },
        "custom": {
          "type": "array",
          "items": {
            "type": "object",
            "required": [
              "message",
              "predicate"
            ],
            "properties": {
              "message": {
                "type": "string"
              },
              "predicate": {
                "type": "string"
              }
            },
            "additionalProperties": false
          },
          "default": []
        }
      }
    },
    "ioHints": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "stdin": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "accepts": {
              "type": "boolean"
            },
            "when": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          }
        },
        "stdout": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "default": {
              "enum": [
                "text",
                "table",
                "json",
                "yaml",
                "ndjson",
                "binary"
              ]
            }
          }
        },
        "stderr": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "diagnostics": {
              "type": "boolean"
            }
          }
        }
      }
    },
    "argCommon": {
      "type": "object",
      "additionalProperties": true,
      "required": [
        "id",
        "description_short"
      ],
      "properties": {
        "id": {
          "type": "string"
        },
        "description_short": {
          "type": "string"
        },
        "description_long": {
          "type": "string"
        },
        "required": {
          "type": "boolean",
          "default": false
        },
        "hidden": {
          "type": "boolean",
          "default": false
        },
        "deprecated_since": {
          "type": "string"
        },
        "env": {
          "$ref": "#/$defs/envDef"
        },
        "default": {},
        "type": {
          "oneOf": [
            {
              "type": "string"
            },
            {
              "$ref": "#/$defs/typeInline"
            }
          ]
        },
        "arity": {
          "type": "string",
          "pattern": "^(\\*|\\d+|\\d+\\.\\.\\d+|\\d+\\.\\.\\*|0\\.\\.\\*|0\\.\\.1)$",
          "default": "1"
        },
        "validator": {
          "type": "string"
        },
        "value_name": {
          "type": "string"
        }
      }
    },
    "optionDefNoId": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "names": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "minItems": 1
        },
        "kind": {
          "enum": [
            "flag",
            "option"
          ]
        },
        "takes_value": {
          "type": "boolean"
        },
        "type": {
          "oneOf": [
            {
              "type": "string"
            },
            {
              "$ref": "#/$defs/typeInline"
            }
          ]
        },
        "value_name": {
          "type": "string"
        },
        "description_short": {
          "type": "string"
        },
        "description_long": {
          "type": "string"
        },
        "default": {},
        "env": {
          "$ref": "#/$defs/envDef"
        }
      },
      "required": [
        "names",
        "kind",
        "description_short"
      ]
    },
    "optionUse": {
      "allOf": [
        {
          "$ref": "#/$defs/argCommon"
        },
        {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "id",
            "names",
            "kind"
          ],
          "properties": {
            "$ref": {
              "type": "string"
            },
            "names": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "minItems": 1
            },
            "kind": {
              "enum": [
                "flag",
                "option"
              ]
            },
            "takes_value": {
              "type": "boolean"
            }
          }
        }
      ]
    },
    "positionalUse": {
      "allOf": [
        {
          "$ref": "#/$defs/argCommon"
        },
        {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "id",
            "name",
            "kind"
          ],
          "properties": {
            "$ref": {
              "type": "string"
            },
            "name": {
              "type": "string"
            },
            "kind": {
              "const": "positional"
            }
          }
        }
      ]
    },
    "actionDefNoId": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "names": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "minItems": 1
        },
        "description_short": {
          "type": "string"
        },
        "description_long": {
          "type": "string"
        },
        "options": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/optionUse"
          },
          "default": []
        },
        "positionals": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/positionalUse"
          },
          "default": []
        },
        "constraints": {
          "$ref": "#/$defs/constraints"
        },
        "io": {
          "$ref": "#/$defs/ioHints"
        }
      },
      "required": [
        "names",
        "description_short"
      ]
    },
    "actionRefOrOverride": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "id"
      ],
      "properties": {
        "id": {
          "type": "string"
        },
        "$ref": {
          "type": "string"
        },
        "names": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "description_short": {
          "type": "string"
        },
        "description_long": {
          "type": "string"
        },
        "options": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/optionUse"
          },
          "default": []
        },
        "positionals": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/positionalUse"
          },
          "default": []
        },
        "constraints": {
          "$ref": "#/$defs/constraints"
        },
        "io": {
          "$ref": "#/$defs/ioHints"
        },
        "examples": {
          "type": "array",
          "items": {
            "oneOf": [
              {
                "type": "object",
                "required": [
                  "description",
                  "scenario"
                ],
                "properties": {
                  "description": {
                    "type": "string"
                  },
                  "scenario": {
                    "$ref": "#/$defs/exampleScenario"
                  }
                }
              },
              {
                "type": "object",
                "required": [
                  "cmd"
                ],
                "properties": {
                  "cmd": {
                    "type": "string"
                  },
                  "description": {
                    "type": "string"
                  }
                }
              }
            ]
          },
          "default": []
        }
      }
    },
    "actionUse": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "id",
        "names",
        "description_short"
      ],
      "properties": {
        "id": {
          "type": "string"
        },
        "$ref": {
          "type": "string"
        },
        "names": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "description_short": {
          "type": "string"
        },
        "description_long": {
          "type": "string"
        },
        "options": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/optionUse"
          },
          "default": []
        },
        "positionals": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/positionalUse"
          },
          "default": []
        },
        "constraints": {
          "$ref": "#/$defs/constraints"
        },
        "io": {
          "$ref": "#/$defs/ioHints"
        },
        "objects": {
          "type": "array",
          "items": {
            "oneOf": [
              {
                "type": "string"
              },
              {
                "type": "object",
                "additionalProperties": false,
                "required": [
                  "id"
                ],
                "properties": {
                  "id": {
                    "type": "string"
                  },
                  "$ref": {
                    "type": "string"
                  },
                  "names": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  },
                  "description_short": {
                    "type": "string"
                  },
                  "description_long": {
                    "type": "string"
                  },
                  "options": {
                    "type": "array",
                    "items": {
                      "$ref": "#/$defs/optionUse"
                    },
                    "default": []
                  },
                  "positionals": {
                    "type": "array",
                    "items": {
                      "$ref": "#/$defs/positionalUse"
                    },
                    "default": []
                  },
                  "constraints": {
                    "$ref": "#/$defs/constraints"
                  },
                  "io": {
                    "$ref": "#/$defs/ioHints"
                  },
                  "examples": {
                    "type": "array",
                    "items": {
                      "oneOf": [
                        {
                          "type": "object",
                          "required": [
                            "description",
                            "scenario"
                          ],
                          "properties": {
                            "description": {
                              "type": "string"
                            },
                            "scenario": {
                              "$ref": "#/$defs/exampleScenario"
                            }
                          }
                        },
                        {
                          "type": "object",
                          "required": [
                            "cmd"
                          ],
                          "properties": {
                            "cmd": {
                              "type": "string"
                            },
                            "description": {
                              "type": "string"
                            }
                          }
                        }
                      ]
                    },
                    "default": []
                  }
                }
              }
            ]
          },
          "default": []
        },
        "default_object": {
          "type": "string"
        },
        "examples": {
          "type": "array",
          "items": {
            "oneOf": [
              {
                "type": "object",
                "required": [
                  "description",
                  "scenario"
                ],
                "properties": {
                  "description": {
                    "type": "string"
                  },
                  "scenario": {
                    "$ref": "#/$defs/exampleScenario"
                  }
                }
              },
              {
                "type": "object",
                "required": [
                  "cmd"
                ],
                "properties": {
                  "cmd": {
                    "type": "string"
                  },
                  "description": {
                    "type": "string"
                  }
                }
              }
            ]
          },
          "default": []
        }
      }
    },
    "objectDefNoId": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "names": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "minItems": 1
        },
        "description_short": {
          "type": "string"
        },
        "description_long": {
          "type": "string"
        },
        "options": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/optionUse"
          },
          "default": []
        },
        "positionals": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/positionalUse"
          },
          "default": []
        },
        "constraints": {
          "$ref": "#/$defs/constraints"
        },
        "io": {
          "$ref": "#/$defs/ioHints"
        },
        "actions": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/actionRefOrOverride"
          },
          "default": []
        },
        "default_action": {
          "type": "string"
        }
      },
      "required": [
        "names",
        "description_short"
      ]
    },
    "objectUse": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "id",
        "names",
        "description_short"
      ],
      "properties": {
        "id": {
          "type": "string"
        },
        "$ref": {
          "type": "string"
        },
        "names": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "description_short": {
          "type": "string"
        },
        "description_long": {
          "type": "string"
        },
        "options": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/optionUse"
          },
          "default": []
        },
        "positionals": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/positionalUse"
          },
          "default": []
        },
        "constraints": {
          "$ref": "#/$defs/constraints"
        },
        "io": {
          "$ref": "#/$defs/ioHints"
        },
        "actions": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/actionRefOrOverride"
          },
          "default": []
        },
        "default_action": {
          "type": "string"
        },
        "examples": {
          "type": "array",
          "items": {
            "oneOf": [
              {
                "type": "object",
                "required": [
                  "description",
                  "scenario"
                ],
                "properties": {
                  "description": {
                    "type": "string"
                  },
                  "scenario": {
                    "$ref": "#/$defs/exampleScenario"
                  }
                }
              },
              {
                "type": "object",
                "required": [
                  "cmd"
                ],
                "properties": {
                  "cmd": {
                    "type": "string"
                  },
                  "description": {
                    "type": "string"
                  }
                }
              }
            ]
          },
          "default": []
        }
      }
    }
  }
}